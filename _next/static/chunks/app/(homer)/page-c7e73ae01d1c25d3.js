(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[625],{956:function(e,t,r){Promise.resolve().then(r.bind(r,5207))},5207:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page}});var a=r(7437),s=r(8089),n=r(7801),i=r(7916),o=r(6427),l=r(4312),c=r(4387),d=r(2265),u=r(6282),h=r(2838),m=r(7833),p=r(251),f=r(4033),g=r(3968),x=r(5397),b=r(9851),v=r(753),y=r(5409),j=r(7698),w=r(9621),create_new_request=e=>{let{visible:t,onHide:r,onSubmit:n,onCancel:i}=e,[l,u]=(0,d.useState)(!1),h=(0,d.useRef)(null),{currentRequest:m,setCurrentRequest:p,saveRequest:f,fetchBrandsForCurrentRequest:q,brands:C,setBrands:E,selectedBrands:R,setSelectedBrands:P,getEmptyRequest:N}=(0,w.useRequest)(),onDialogHide=()=>{p(N()),E([]),P([]),u(!1),r()},onInputChange=(e,t)=>{let r=e.target&&e.target.value||"",a={...m};a["".concat(t)]=r,p(a)},onInputNumberChange=(e,t)=>{let r=e.target&&e.target.value||0,a={...m};a["".concat(t)]=r,p(a)},selectBrands=e=>{let t={...m};t.brands=e.map(e=>e.brand),p(t),P(e)},k=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.z,{label:(0,g.t)("dialog.common.cancel"),icon:"pi pi-times",text:!0,onClick:()=>{onDialogHide(),i()}}),(0,a.jsx)(s.z,{label:(0,g.t)("dialog.common.save"),icon:"pi pi-check",text:!0,onClick:()=>{if(u(!0),m.number.trim()){var e,t;m.id?null===(t=h.current)||void 0===t||t.show({severity:"success",summary:"".concat((0,g.t)("toast.summary.successful")),detail:"".concat((0,g.t)("toast.details.updated")),life:3e3}):null===(e=h.current)||void 0===e||e.show({severity:"success",summary:"".concat((0,g.t)("toast.summary.successful")),detail:"".concat((0,g.t)("toast.details.created")),life:3e3}),f(),onDialogHide(),n()}}})]});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.F,{ref:h,position:"bottom-right"}),(0,a.jsxs)(x.V,{visible:t,onHide:onDialogHide,header:(0,g.t)("dialog.new.header"),modal:!0,footer:k,className:"p-fluid",children:[(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"number",children:(0,g.t)("dialog.new.labels.number")}),(0,a.jsx)(o.o,{id:"number",value:m.number,onChange:e=>onInputChange(e,"number"),required:!0,autoFocus:!0,className:(0,b.AK)({"p-invalid":l&&!m.number})}),l&&!m.number&&(0,a.jsx)("div",{className:"text-sm p-invalid",children:(0,g.t)("dialog.new.errors.number")})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"edit-brands",children:(0,g.t)("dialog.new.labels.brands")}),(0,a.jsx)(y.N,{inputId:"edit-brands",value:R,onChange:e=>selectBrands(e.value),onFocus:()=>q().catch(e=>{var t;P([]),E([]),null===(t=h.current)||void 0===t||t.show({severity:"error",summary:"".concat((0,g.t)("toast.summary.error")),detail:"".concat((0,g.t)("toast.details.error")),life:3e3})}),options:C,optionLabel:"brand",display:"chip",placeholder:(0,g.t)("dialog.new.placeholders.brands"),className:"w-full",disabled:!m.number})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"edit-maxPrice",children:(0,g.t)("dialog.new.labels.max-price")}),(0,a.jsx)(v.R,{inputId:"edit-maxPrice",value:m.maxPrice,onValueChange:e=>onInputNumberChange(e,"maxPrice"),required:!0,mode:"decimal",maxFractionDigits:2,className:(0,b.AK)({"p-invalid":l&&!m.number})}),l&&!m.number&&(0,a.jsx)("div",{className:"text-sm p-invalid",children:(0,g.t)("dialog.new.errors.max-price")})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"edit-maxDeliveryDays",children:(0,g.t)("dialog.new.labels.max-delivery-days")}),(0,a.jsx)(v.R,{inputId:"edit-maxDeliveryDays",value:m.maxDeliveryDays,onValueChange:e=>onInputNumberChange(e,"maxDeliveryDays"),required:!0,className:(0,b.AK)({"p-invalid":l&&!m.number})}),l&&!m.number&&(0,a.jsx)("div",{className:"text-sm p-invalid",children:(0,g.t)("dialog.new.errors.max-delivery-days")})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"edit-note",children:(0,g.t)("dialog.new.labels.note")}),(0,a.jsx)(j.g,{id:"edit-note",value:m.note?m.note:m.note=m.number,required:!0,rows:3,cols:20,onChange:e=>onInputChange(e,"note"),onClick:e=>e.currentTarget.select()})]})]})]})},delete_request=e=>{let{visible:t,onHide:r,onSubmit:n,onCancel:i}=e,{currentRequest:o,setCurrentRequest:l,deleteRequest:u,getEmptyRequest:h}=(0,w.useRequest)(),m=(0,d.useRef)(null),handleHide=()=>{l(h()),r()},handleDeleteRequest=async()=>{u().then(()=>l(h())).then(()=>n()).then(()=>handleHide()).then(()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.show({severity:"success",summary:"".concat((0,g.t)("toast.summary.successful")),detail:"".concat((0,g.t)("toast.details.deleted")),life:3e3})}).catch(e=>{var t;null===(t=m.current)||void 0===t||t.show({severity:"error",summary:"".concat((0,g.t)("toast.summary.error")),detail:"".concat((0,g.t)("toast.details.error")),life:3e3})})},p=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.z,{label:(0,g.t)("dialog.common.no"),icon:"pi pi-times",text:!0,onClick:()=>{handleHide(),i()}}),(0,a.jsx)(s.z,{label:(0,g.t)("dialog.common.yes"),icon:"pi pi-check",text:!0,onClick:handleDeleteRequest})]});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.F,{ref:m,position:"bottom-right"}),(0,a.jsx)(x.V,{visible:t,style:{width:"450px"},header:(0,g.t)("dialog.delete.header"),modal:!0,footer:p,onHide:handleHide,children:(0,a.jsxs)("div",{className:"flex align-items-center justify-content-center",children:[(0,a.jsx)("i",{className:"pi pi-exclamation-triangle mr-3",style:{fontSize:"2rem"}}),o&&(0,a.jsxs)("span",{children:[(0,g.t)("dialog.delete.msg")," ",(0,a.jsx)("b",{children:o.number})," - ",(0,a.jsx)("b",{children:o.note}),"?"]})]})})]})},q=r(7805),page=()=>{let e=(0,f.useRouter)(),{t}=(0,p.$G)(),r=(0,d.useRef)(null),g=(0,d.useRef)(null),[x,b]=(0,d.useState)(""),[v,y]=(0,d.useState)(null),[j,C]=(0,d.useState)(!1),[E,R]=(0,d.useState)(!1),{requests:P,setRequests:N,fetchRequests:k,setCurrentRequest:S,setBrands:D,setSelectedBrands:T,updateStatus:z}=(0,w.useRequest)();(0,d.useEffect)(()=>{k()},[]);let updateRequest=e=>{S(e),e.number&&(null===e.brands&&(e.brands=[]),D(e.brands.map(e=>({brand:e}))),T(e.brands.map(e=>({brand:e})))),C(!0)},confirmDeleteRequest=e=>{S(e),R(!0)},findIndexById=e=>{let t=-1;for(let r=0;r<(null==P?void 0:P.length);r++)if(P[r].id===e){t=r;break}return t},onStatusChange=async e=>{var a,s,n;let i=[...P],o=(null===(a=e.target)||void 0===a?void 0:a.value)?findIndexById(e.target.value.toString()):-1,l={...i[o]};l.status=(null===(s=e.target)||void 0===s?void 0:s.checked)?"OPEN":"CLOSED",z(l),null===(n=r.current)||void 0===n||n.show({severity:"success",summary:"".concat(t("toast.summary.successful")),detail:"".concat(t("toast.details.status-changed",{number:l.number,status:l.status})),life:3e3})},F=(0,a.jsxs)("div",{className:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",children:[(0,a.jsxs)("span",{className:"block mt-2 md:mt-0 p-input-icon-left",children:[(0,a.jsx)("i",{className:"pi pi-search"}),(0,a.jsx)(o.o,{id:"requests-filter",type:"search",onInput:e=>b(e.currentTarget.value),placeholder:t("common.input-search")})]}),(0,a.jsx)(s.z,{label:t("common.btn-new-request"),icon:"pi pi-plus",className:" mr-2",onClick:()=>C(!0)})]});return(0,a.jsx)("div",{className:"grid crud-homer",children:(0,a.jsx)("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)(c.F,{ref:r,position:"bottom-right"}),(0,a.jsxs)(i.w,{ref:g,value:P,selection:v,onSelectionChange:e=>y(e.value),dataKey:"id",paginator:!0,rows:100,rowsPerPageOptions:[5,10,25,100],className:"datatable-responsive",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:t("table.pagination"),globalFilter:x,emptyMessage:t("table.common.no-request-found"),header:F,responsiveLayout:"scroll",size:"small",stripedRows:!0,showGridlines:!0,children:[(0,a.jsx)(n.s,{field:"status",body:e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.X,{inputId:"status-".concat(e.id),name:"status-".concat(e.id),onChange:e=>onStatusChange(e),checked:"OPEN"===e.status,value:e.id})})}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"8rem"},header:t("table.header.number"),headerTooltip:t("table.tooltips.number"),field:"number",body:e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex align-items-center justify-content-left",children:[e.number,(0,a.jsx)("a",{href:"https://tehnomir.com.ua/index.php?r=product/search&SearchForm[code]=".concat(e.number),target:"_blank",rel:"noreferrer",children:(0,a.jsx)("i",{className:"pi pi-external-link ml-2",style:{fontSize:".75rem"}})}),(0,a.jsx)("a",{href:"#",onClick:()=>(navigator.clipboard.writeText(e.number),!1),children:(0,a.jsx)("i",{className:"pi pi-copy ml-2",style:{fontSize:".75rem"}})})]})})}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"2rem"},header:t("table.header.max-price"),headerTooltip:t("table.tooltips.max-price"),field:"maxPrice"}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"4rem"},header:t("table.header.last-min-price"),headerTooltip:t("table.tooltips.last-min-price"),field:"lastMinPrice",body:e=>(e.lastMinPrice,e.lastMinPrice,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.u,{target:"#last-min-price-".concat(e.id),content:void 0===e.lastMinPrice||0===e.lastMinPrice?t("table.fields.no-last-min-price"):"".concat(t("table.fields.last-min-price-time")," ").concat((0,h.Z)(e.lastMinPriceTime).format("DD.MM.YYYY HH:mm:ss"))}),(0,a.jsx)(q.V,{id:"last-min-price-".concat(e.id),icon:void 0===e.lastMinPrice||0===e.lastMinPrice?"pi pi-exclamation-triangle":e.lastMinPrice>e.maxPrice?"pi pi-arrow-up":"pi pi-arrow-down",severity:void 0===e.lastMinPrice||0===e.lastMinPrice?"warning":e.lastMinPrice>e.maxPrice?"danger":null,value:void 0===e.lastMinPrice||0===e.lastMinPrice?t("table.fields.no-last-min-price"):e.lastMinPrice})]}))}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"4rem"},header:t("table.header.max-delivery-days"),headerTooltip:t("table.tooltips.max-delivery-days"),field:"maxDeliveryDays"}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"16rem"},header:t("table.header.note"),headerTooltip:t("table.tooltips.note"),field:"note"}),(0,a.jsx)(n.s,{sortable:!0,headerStyle:{minWidth:"2rem"},header:t("table.header.last-update"),headerTooltip:t("table.tooltips.last-update"),field:"updated",body:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.u,{target:"#created-and-last-update-".concat(e.id),content:"".concat(t("table.fields.created")," ").concat((0,h.Z)(e.created).format("DD.MM.YYYY HH:mm:ss"),"\n").concat(t("table.fields.last-update")," ").concat((0,h.Z)(e.updated).format("DD.MM.YYYY HH:mm:ss"))}),(0,a.jsx)("i",{id:"created-and-last-update-".concat(e.id),className:"created-and-last-update",children:(0,h.Z)(e.updated).fromNow()})]})}),(0,a.jsx)(n.s,{body:e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex align-items-center justify-content-center",children:[(0,a.jsx)(s.z,{icon:"pi pi-pencil",size:"small",className:"mr-2",onClick:()=>updateRequest(e)}),(0,a.jsx)(s.z,{icon:"pi pi-trash",size:"small",severity:"danger",onClick:()=>confirmDeleteRequest(e)})]})}),align:"right",style:{minWidth:"2rem"}})]}),(0,a.jsx)(create_new_request,{visible:j,onHide:()=>C(!1),onSubmit:()=>u.s.getRequests().then(e=>N(e)).catch(t=>{e.push("/login")}),onCancel:()=>{}}),(0,a.jsx)(delete_request,{visible:E,onHide:()=>R(!1),onSubmit:()=>k(),onCancel:()=>{}})]})})})}},9621:function(e,t,r){"use strict";r.r(t),r.d(t,{RequestProvider:function(){return RequestProvider},useRequest:function(){return useRequest}});var a=r(7437),s=r(2265),n=r(2067),i=r.n(n),o=r(6282);let l=s.createContext(void 0),RequestProvider=e=>{let{children:t}=e,r={id:void 0,number:"",brands:[],maxPrice:.01,note:"",created:i()(),updated:i()(),status:"CLOSED",maxDeliveryDays:100,lastMinPrice:0,lastMinPriceTime:i()()},[n,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(r),[h,m]=(0,s.useState)([]),[p,f]=(0,s.useState)([]),fetchRequests=async()=>{await o.s.getRequests().then(e=>c(e)).catch(e=>{throw AggregateError(e,"Error fetching requests")})},saveRequest=async()=>{d&&(d.id?await o.s.updateRequest(d).then(()=>u(r)).then(()=>fetchRequests()):await o.s.createRequest(d).then(()=>u(r)).then(()=>fetchRequests()))},deleteRequest=async()=>{if(!d||!d.id)throw Error("Current request is not set");await o.s.deleteRequest(d).then(()=>fetchRequests())},fetchBrandsForCurrentRequest=async()=>{if(!d)throw Error("Current request is not set");await o.s.getAllBrandsByNumber(d.number).then(e=>m(e.map(e=>({brand:e}))))},updateStatus=async e=>{await o.s.updateStatus(e).then(()=>fetchRequests()).catch(e=>{throw AggregateError(e,"Error updating status")})};return(0,a.jsx)(l.Provider,{value:{requests:n,setRequests:c,currentRequest:d,setCurrentRequest:u,brands:h,setBrands:m,selectedBrands:p,setSelectedBrands:f,fetchRequests,saveRequest,deleteRequest,fetchBrandsForCurrentRequest,updateStatus,getEmptyRequest:()=>r},children:t})},useRequest=()=>{let e=s.useContext(l);if(!e)throw Error("useRequest must be used within a RequestProvider");return e}},2838:function(e,t,r){"use strict";var a=r(3968),s=r(2067),n=r.n(s);r(8890),r(5670),n().locale(a.ZP.language),t.Z=n()},6282:function(e,t,r){"use strict";r.d(t,{s:function(){return a}});let a={async getRequests(){let e=localStorage.getItem("token");if(!e)throw Error("Error: no token found");let t=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests"),{headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(401===t.status)throw Error("Error: unauthorized");if(!t.ok)throw Error("Error: ".concat(t.statusText));let r=await t.json();return r},async deleteRequest(e){let t=localStorage.getItem("token");if(!t)throw Error("Error: no token found");let r=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests/").concat(e.id),{method:"DELETE",headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(401===r.status)throw Error("Error: unauthorized");if(!r.ok)throw Error("Error: ".concat(r.statusText))},async updateStatus(e){let t=localStorage.getItem("token");if(!t)throw Error("Error: no token found");let r=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests/status/").concat(e.id),{method:"PUT",headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(401===r.status)throw Error("Error: unauthorized");if(!r.ok)throw Error("Error: ".concat(r.statusText))},async createRequest(e){let t=localStorage.getItem("token");if(!t)throw Error("Error: no token found");let r=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests"),{method:"POST",headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(401===r.status)throw Error("Error: unauthorized");if(!r.ok)throw Error("Error: ".concat(r.statusText))},async updateRequest(e){let t=localStorage.getItem("token");if(!t)throw Error("Error: no token found");let r=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests"),{method:"PUT",headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(401===r.status)throw Error("Error: unauthorized");if(!r.ok)throw Error("Error: ".concat(r.statusText))},async getAllBrandsByNumber(e){let t=localStorage.getItem("token");if(!t)throw Error("Error: no token found");let r=await fetch("".concat("https://au-homer-fisher-go-953161734119.europe-west1.run.app/api","/requests/").concat(e,"/brands"),{headers:{"Cache-Control":"no-cache","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(401===r.status)throw Error("Error: unauthorized");if(!r.ok)throw Error("Error: ".concat(r.statusText));let a=await r.json();return a}}}},function(e){e.O(0,[990,651,220,164,568,902,18,851,971,472,744],function(){return e(e.s=956)}),_N_E=e.O()}]);